<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Opportunity Command Center v4</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* EXECUTIVE DESIGN SYSTEM */
:root {
  --primary: #1a237e;
  --secondary: #0066cc;
  --success: #00c853;
  --warning: #ff6f00;
  --danger: #d32f2f;
  --platinum: #6a1b9a;
  --gold: #ffc107;
  --dark-bg: #0a0e27;
  --light-bg: #ffffff;
  --dark-panel: #1e2139;
  --light-panel: #f5f7fa;
  --fire: #ff6f00;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
  background: var(--dark-bg);
  color: #ffffff;
  line-height: 1.6;
  transition: all 0.3s ease;
  padding-top: 80px;
}

body.light-mode {
  background: var(--light-bg);
  color: #333;
}

/* FIXED HEADER & NAVIGATION */
.header {
  background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
  padding: 20px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
}

.header-content {
  max-width: 1600px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-size: 28px;
  font-weight: bold;
  display: flex;
  align-items: center;
  gap: 10px;
}

.ribbon {
  display: flex;
  gap: 20px;
  align-items: center;
}

.ribbon a {
  color: white;
  text-decoration: none;
  padding: 10px 20px;
  border-radius: 25px;
  background: rgba(255,255,255,0.1);
  transition: all 0.3s ease;
  font-weight: 500;
}

.ribbon a:hover, .ribbon a.active {
  background: rgba(255,255,255,0.3);
  transform: translateY(-2px);
}

/* EASY MONEY INDICATOR */
.easy-money {
  display: inline-block;
  margin-left: 5px;
  animation: fire 1s ease-in-out infinite;
  color: var(--fire) !important;
  font-weight: bold !important;
  text-shadow: 0 0 2px rgba(0,0,0,0.5);
}

@keyframes fire {
  0%, 100% { transform: scale(1) rotate(0deg); }
  50% { transform: scale(1.1) rotate(5deg); }
}

/* MAIN LAYOUT */
.container {
  max-width: 1600px;
  margin: 0 auto;
  padding: 30px 20px;
}

/* DASHBOARD */
.dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
}

.metric-card {
  background: var(--dark-panel);
  padding: 25px;
  border-radius: 15px;
  text-align: center;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
}

body.light-mode .metric-card {
  background: var(--light-panel);
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

.metric-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.4);
}

.metric-value {
  font-size: 36px;
  font-weight: bold;
  color: var(--secondary);
  margin-bottom: 5px;
}

.metric-label {
  font-size: 14px;
  opacity: 0.8;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* ACTION BUTTONS */
.action-bar {
  display: flex;
  gap: 15px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.btn {
  padding: 12px 25px;
  border: none;
  border-radius: 25px;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
  color: white;
}

.btn-primary {
  background: var(--primary);
}

.btn-primary:hover {
  background: #283593;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(26,35,126,0.4);
}

.btn-secondary {
  background: var(--secondary);
}

.btn-success {
  background: var(--success);
}

.btn-warning {
  background: var(--warning);
}

.btn-danger {
  background: var(--danger);
}

.btn-contact {
  background: var(--platinum);
}

/* SEARCH & FILTERS */
.search-filters {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr 1fr;
  gap: 15px;
  margin-bottom: 30px;
}

.search-box {
  display: flex;
  gap: 10px;
}

.search-box input {
  flex: 1;
  padding: 12px 20px;
  border: 2px solid var(--secondary);
  border-radius: 25px;
  background: rgba(255,255,255,0.1);
  color: inherit;
  font-size: 16px;
}

body.light-mode .search-box input {
  background: white;
  border-color: #ddd;
}

.filter-select {
  padding: 12px 20px;
  border: 2px solid #444;
  border-radius: 25px;
  background: rgba(255,255,255,0.1);
  color: inherit;
  font-size: 16px;
  cursor: pointer;
}

body.light-mode .filter-select {
  background: white;
  border-color: #ddd;
}

/* TABLE */
.table-container {
  background: var(--dark-panel);
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
}

body.light-mode .table-container {
  background: white;
  box-shadow: 0 3px 15px rgba(0,0,0,0.1);
}

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  background: rgba(0,0,0,0.2);
  padding: 15px;
  text-align: left;
  font-weight: 600;
  text-transform: uppercase;
  font-size: 13px;
  letter-spacing: 1px;
}

body.light-mode th {
  background: #f5f5f5;
}

td {
  padding: 15px;
  border-top: 1px solid rgba(255,255,255,0.1);
}

body.light-mode td {
  border-top: 1px solid #eee;
}

tr:hover {
  background: rgba(255,255,255,0.05);
}

body.light-mode tr:hover {
  background: #f9f9f9;
}

/* COMPANY INFO */
.company-info {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.company-name {
  font-weight: 600;
  font-size: 16px;
}

.company-desc {
  font-size: 13px;
  opacity: 0.8;
}

/* BADGES */
.badge {
  padding: 5px 15px;
  border-radius: 15px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.badge-direct {
  background: var(--secondary);
  color: white;
}

.badge-partner {
  background: var(--platinum);
  color: white;
}

.badge-referral {
  background: var(--gold);
  color: #333;
}

/* SCORE BADGE */
.score-badge {
  padding: 5px 15px;
  border-radius: 15px;
  font-weight: bold;
  font-size: 14px;
}

.score-high {
  background: var(--success);
  color: white;
}

.score-medium {
  background: var(--warning);
  color: white;
}

.score-low {
  background: #666;
  color: white;
}

/* VALUE RANGE */
.value-range {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
}

.value-range .min {
  color: #888;
}

.value-range .max {
  color: var(--success);
  font-size: 16px;
}

/* ACTION BUTTONS IN TABLE */
.action-buttons {
  display: flex;
  gap: 8px;
}

.action-buttons .btn {
  padding: 8px 16px;
  font-size: 14px;
}

/* MODALS */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.8);
  z-index: 2000;
  padding: 20px;
  overflow-y: auto;
}

.modal-content {
  background: var(--dark-panel);
  border-radius: 20px;
  max-width: 900px;
  margin: 50px auto;
  padding: 30px;
  position: relative;
  box-shadow: 0 10px 40px rgba(0,0,0,0.5);
}

body.light-mode .modal-content {
  background: white;
}

.close {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 30px;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.3s;
}

.close:hover {
  opacity: 1;
}

/* CONTACT MODAL */
.contact-options {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  margin-top: 20px;
}

.contact-options .btn {
  width: 100%;
  justify-content: center;
}

/* OUTREACH SCRIPTS */
.outreach-scripts {
  margin-top: 30px;
}

.script-section {
  background: rgba(255,255,255,0.05);
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
}

body.light-mode .script-section {
  background: #f9f9f9;
}

.script-section h3 {
  margin-bottom: 10px;
  color: var(--secondary);
}

/* DROP ZONE */
#dropZone {
  border: 3px dashed var(--secondary);
  border-radius: 20px;
  padding: 50px;
  text-align: center;
  transition: all 0.3s ease;
  background: rgba(255,255,255,0.02);
  margin-bottom: 30px;
}

#dropZone.drag-over {
  border-color: var(--success);
  background: rgba(0,200,83,0.1);
  transform: scale(1.02);
}

/* STAGE MODAL */
#stageModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.8);
  z-index: 2000;
  align-items: center;
  justify-content: center;
}

.stage-content {
  background: var(--dark-panel);
  padding: 30px;
  border-radius: 20px;
  max-width: 500px;
  text-align: center;
}

body.light-mode .stage-content {
  background: white;
}

.stage-buttons {
  display: flex;
  gap: 10px;
  margin-top: 20px;
  flex-wrap: wrap;
  justify-content: center;
}

/* NOTIFICATION */
.notification {
  position: fixed;
  top: 100px;
  right: 20px;
  padding: 15px 25px;
  background: var(--secondary);
  color: white;
  border-radius: 10px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
  transform: translateX(400px);
  transition: transform 0.3s ease;
  z-index: 3000;
}

.notification.show {
  transform: translateX(0);
}

/* THEME TOGGLE */
.theme-toggle {
  background: none;
  border: 2px solid white;
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  cursor: pointer;
  font-size: 20px;
  transition: all 0.3s ease;
}

.theme-toggle:hover {
  background: rgba(255,255,255,0.2);
}

/* GUIDE STYLES */
.guide-container {
  background: white;
  color: #333;
  padding: 30px;
  border-radius: 10px;
  max-height: 70vh;
  overflow-y: auto;
}

.guide-container h1, .guide-container h2, .guide-container h3 {
  color: #0d3c61;
  margin: 20px 0 10px 0;
}

.guide-container table {
  border-collapse: collapse;
  margin: 20px 0;
}

.guide-container th,
.guide-container td {
  border: 1px solid #cbd5e1;
  padding: 10px;
  text-align: left;
}

.guide-container th {
  background: #e2e8f0;
  font-weight: 600;
}

.guide-actions {
  display: flex;
  gap: 10px;
  margin-top: 20px;
  justify-content: flex-end;
}

/* RESPONSIVE */
@media (max-width: 768px) {
  .search-filters {
    grid-template-columns: 1fr;
  }
  
  .dashboard {
    grid-template-columns: 1fr;
  }
  
  .action-bar {
    flex-direction: column;
  }
  
  .table-container {
    overflow-x: auto;
  }
  
  table {
    min-width: 800px;
  }
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="header-content">
    <div class="logo">
      üöÄ AI Opportunity Command Center v4
    </div>
    <nav class="ribbon">
      <a href="#dashboard" class="active">Dashboard</a>
      <a href="#opportunities">Opportunities</a>
      <a href="#analytics">Analytics</a>
      <a href="#guides">Guides</a>
      <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
    </nav>
  </div>
</header>

<!-- MAIN CONTAINER -->
<div class="container">
  
  <!-- DASHBOARD -->
  <div id="dashboard" class="dashboard">
    <div class="metric-card">
      <div class="metric-value" id="totalOpportunities">0</div>
      <div class="metric-label">Total Opportunities</div>
    </div>
    <div class="metric-card">
      <div class="metric-value" id="totalValue">$0</div>
      <div class="metric-label">Pipeline Value</div>
    </div>
    <div class="metric-card">
      <div class="metric-value" id="avgScore">0</div>
      <div class="metric-label">Avg Score</div>
    </div>
    <div class="metric-card">
      <div class="metric-value" id="easyMoneyCount">0</div>
      <div class="metric-label">Easy Money üî•</div>
    </div>
  </div>

  <!-- ACTION BAR -->
  <div class="action-bar">
    <button class="btn btn-primary" onclick="runAutomatedSearch()">
      üîç Run Automated Search
    </button>
    <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">
      üì§ Upload LinkedIn HTML
    </button>
    <button class="btn btn-warning" onclick="exportOpportunities()">
      üìä Export Pipeline
    </button>
    <button class="btn btn-success" onclick="showBestPractices()">
      üí° Best Practices
    </button>
  </div>

  <!-- FILE UPLOAD (hidden) -->
  <input type="file" id="fileInput" accept=".html" style="display: none" onchange="handleFileSelect(event)">

  <!-- DROP ZONE -->
  <div id="dropZone" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
    <h3>üìÅ Drag & Drop LinkedIn Job HTML Files Here</h3>
    <p>Or click "Upload LinkedIn HTML" button above</p>
  </div>

  <!-- SEARCH & FILTERS -->
  <div class="search-filters">
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="üîç Search companies..." onkeyup="filterOpportunities()">
    </div>
    <select class="filter-select" id="typeFilter" onchange="filterOpportunities()">
      <option value="all">All Types</option>
      <option value="direct">Direct</option>
      <option value="partner">Partner</option>
      <option value="referral">Referral</option>
    </select>
    <select class="filter-select" id="stageFilter" onchange="filterOpportunities()">
      <option value="all">All Stages</option>
      <option value="discovered">Discovered</option>
      <option value="qualified">Qualified</option>
      <option value="contacted">Contacted</option>
      <option value="proposal">Proposal</option>
      <option value="negotiation">Negotiation</option>
      <option value="closed">Closed</option>
    </select>
    <select class="filter-select" id="sortBy" onchange="sortOpportunities()">
      <option value="score">Sort by Score</option>
      <option value="value">Sort by Value</option>
      <option value="company">Sort by Company</option>
      <option value="dateAdded">Sort by Date Added</option>
    </select>
  </div>

  <!-- OPPORTUNITIES TABLE -->
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Company</th>
          <th>Type</th>
          <th>Score</th>
          <th>Value Range</th>
          <th>Stage</th>
          <th>Date Added</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="opportunitiesTable">
        <!-- Opportunities will be rendered here -->
      </tbody>
    </table>
  </div>

</div>

<!-- OPPORTUNITY MODAL -->
<div id="opportunityModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <div id="modalContent">
      <!-- Modal content will be inserted here -->
    </div>
  </div>
</div>

<!-- CONTACT MODAL -->
<div id="contactModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeContactModal()">&times;</span>
    <h2 id="contactCompanyName">Contact Company</h2>
    
    <div class="contact-options">
      <button class="btn btn-primary" onclick="sendEmail()">üìß Send Email</button>
      <button class="btn btn-secondary" onclick="openLinkedIn()">üíº LinkedIn</button>
      <button class="btn btn-success" onclick="makeCall()">üìû Call</button>
      <button class="btn btn-warning" onclick="scheduleFollowUp()">üìÖ Schedule Follow-up</button>
    </div>
    
    <div class="outreach-scripts">
      <div class="script-section">
        <h3>üìß Email Template</h3>
        <p id="emailScript">Loading...</p>
      </div>
      
      <div class="script-section">
        <h3>üíº LinkedIn Message</h3>
        <p id="linkedinScript">Loading...</p>
      </div>
      
      <div class="script-section">
        <h3>üìû Call Script</h3>
        <p id="callScript">Loading...</p>
      </div>
    </div>
  </div>
</div>

<!-- STAGE SELECTION MODAL -->
<div id="stageModal">
  <div class="stage-content">
    <h2>Select Pipeline Stage for <span id="modalCompanyName"></span></h2>
    <div class="stage-buttons">
      <button class="btn btn-primary" onclick="selectStage('discovered')">Discovered</button>
      <button class="btn btn-secondary" onclick="selectStage('qualified')">Qualified</button>
      <button class="btn btn-success" onclick="selectStage('contacted')">Contacted</button>
      <button class="btn btn-warning" onclick="selectStage('proposal')">Proposal</button>
    </div>
  </div>
</div>

<!-- NOTIFICATION -->
<div id="notification" class="notification"></div>

<script>
// GUIDE GENERATOR OBJECT
const GuideGenerator = {
  createGuide: function(opportunity) {
    const industry = opportunity.industry || 'General Business';
    const industryData = this.getIndustryData(industry);
    
    return `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Consulting Opportunity Playbook ‚Äì ${opportunity.company}</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
  html{font-family:Arial,Helvetica,sans-serif;background:#f7f9fc;color:#222;line-height:1.6;}
  body{margin:0;padding:2rem 2.5rem;max-width:1100px;margin-inline:auto;}
  h1,h2,h3{margin:0 0 .7rem;font-weight:600;color:#0d3c61;}
  h1{font-size:2rem;margin-bottom:1rem;}
  table{width:100%;border-collapse:collapse;margin-bottom:1.4rem;}
  th,td{border:1px solid #cbd5e1;padding:.55rem .6rem;text-align:left;}
  th{background:#e2e8f0;font-weight:600;}
  .warn{background:#fee2e2;}
  footer{margin-top:2rem;font-size:.85rem;color:#475569;}
</style>
</head>
<body>
<h1>${opportunity.company} AI Enhancement Playbook ‚Äì AI Consulting Opportunity</h1>
<p><strong>Job Type:</strong> ${opportunity.title || 'AI Consulting Engagement'}</p>
<h3>Company Overview</h3>
<ul>
  <li><strong>Products / Services:</strong> ${industryData.products}</li>
  <li><strong>What the Company Does:</strong> ${industryData.description}</li>
  <li><strong>Primary Business Model:</strong> ${industryData.businessModel}</li>
</ul>

<h2>0 | Quick‚ÄëStart Workflow</h2>
<ol>
<li>Job‚ÄëPosting Harvest ‚Äì Opportunity captured from ${opportunity.opportunityType === 'hidden' ? 'operational role listing' : 'direct AI search'}.</li>
<li>Background & Vetting Pass ‚Äì Applied four-lens analysis to ${industry}.</li>
<li>Eight‚ÄëStep Opportunity Scan ‚Äì Completed comprehensive matrix for ${opportunity.company}.</li>
<li>Engagement Timeline & Pricing ‚Äì Phases drafted with ${industry}-specific milestones.</li>
<li>ROI Ladder + Cost Calc ‚Äì Built value tables for ${opportunity.painPoint || 'process optimization'}.</li>
<li>Executive Brief ‚Äì Populated with ${industry} AI transformation value.</li>
<li>Pack sent to management ‚Äì Brief & pricing for ${industry} AI initiative.</li>
</ol>

<h2>1 | Company Vetting Snapshot</h2>
<table>
<tr><th>Analysis</th><th>Finding</th><th>Interpretation</th></tr>
<tr><td><strong>Brody</strong> ‚Äì Urgency Check</td><td>${opportunity.score > 80 ? 'High urgency' : 'Moderate urgency'} based on ${opportunity.painPoint || 'market conditions'}</td><td>${opportunity.score > 80 ? 'Move fast - competitive opportunity' : 'Standard engagement timeline'}</td></tr>
<tr><td><strong>Kevin</strong> ‚Äì Financial Review</td><td>${opportunity.minValue >= 100000 ? 'Strong budget indicators' : 'Cost-conscious approach'}</td><td>Position as ${opportunity.minValue >= 100000 ? 'strategic transformation' : 'ROI-focused solution'}</td></tr>
<tr><td><strong>Karen</strong> ‚Äì Compliance Scan</td><td>${industryData.compliance}</td><td>Include compliance in solution design</td></tr>
<tr><td><strong>Pinko</strong> ‚Äì Market Position</td><td>${opportunity.type === 'partner' ? 'Partner opportunity with multiplier effect' : 'Direct engagement opportunity'}</td><td>${opportunity.type === 'partner' ? `Leverage ${opportunity.multiplier || '10'}x revenue potential` : 'Focus on immediate value delivery'}</td></tr>
</table>

<h2>2 | Eight‚ÄëStep Opportunity Matrix</h2>
<ol>
<li>Rapid Public‚ÄëData Sweep ‚Äì ${industry} market ${industryData.marketGrowth}, key trends: ${industryData.trends}.</li>
<li>Multi‚ÄëPass Deep Dive ‚Äì ${opportunity.painPoint || 'Operational inefficiencies'} identified as primary challenge.</li>
<li>Pain‚ÄëPoint Validation ‚Äì ${industryData.painPoints}.</li>
<li>Lead‚ÄëType Mapping ‚Äì ${opportunity.type === 'direct' ? 'Direct implementation' : opportunity.type === 'partner' ? 'Partner channel' : 'Referral-based'} engagement model.</li>
<li>Solution Catalogue ‚Äì ${industryData.solutions}.</li>
<li>Financial Modeling ‚Äì MVP pays back in ${opportunity.easyMoney ? '2-3' : '4-6'} months; Full suite increases efficiency ${opportunity.easyMoney ? '25%' : '35-50%'}.</li>
<li>Integration Audit ‚Äì ${industryData.integrations}.</li>
<li>Decision Gates ‚Äì Gate 1: Quick Win MVP, Gate 2: Core System, Gate 3: Full Platform.</li>
</ol>

<h2>3 | Engagement Phases & Pricing</h2>
<table>
<tr><th>Phase</th><th>Duration*</th><th>Deliverables</th><th>Fee</th></tr>
<tr><td>Discovery & Assessment</td><td>2 weeks</td><td>Current state analysis, AI opportunity mapping, ROI projection</td><td>$${(opportunity.minValue * 0.1).toLocaleString()}</td></tr>
<tr><td>Quick Win MVP</td><td>4-6 weeks</td><td>${industryData.mvpDeliverable}</td><td>$${(opportunity.minValue * 0.3).toLocaleString()} ‚Äì $${(opportunity.minValue * 0.5).toLocaleString()}</td></tr>
<tr><td>Core System Build</td><td>2-3 months</td><td>${industryData.coreDeliverable}</td><td>$${(opportunity.minValue * 0.8).toLocaleString()} ‚Äì $${(opportunity.maxValue * 0.3).toLocaleString()}</td></tr>
<tr><td>Full Platform</td><td>4-6 months</td><td>${industryData.fullDeliverable}</td><td>$${(opportunity.maxValue * 0.5).toLocaleString()} ‚Äì $${opportunity.maxValue.toLocaleString()}</td></tr>
<tr><td>Ongoing Support</td><td>Monthly</td><td>Updates, optimization, new features</td><td>$${Math.round(opportunity.minValue * 0.05 / 1000) * 1000} ‚Äì $${Math.round(opportunity.maxValue * 0.02 / 1000) * 1000}</td></tr>
</table>

<h2>4 | ROI Ladder & Cost Calculator</h2>
<h3>4.1 Lean‚Äëto‚ÄëFull Road‚ÄëMap</h3>
<table>
<tr><th>Phase</th><th>Investment</th><th>Time‚Äëto‚ÄëValue</th><th>Year‚Äë1 Return</th><th>ROI Multiple</th></tr>
<tr><td>Quick Win</td><td>$${opportunity.minValue.toLocaleString()}</td><td>6 weeks</td><td>$${(opportunity.minValue * 2.5).toLocaleString()}</td><td>2.5√ó</td></tr>
<tr><td>Core System</td><td>$${((opportunity.minValue + opportunity.maxValue) / 2).toLocaleString()}</td><td>12 weeks</td><td>$${((opportunity.minValue + opportunity.maxValue) * 1.5).toLocaleString()}</td><td>3.0√ó</td></tr>
<tr><td>Full Platform</td><td>$${opportunity.maxValue.toLocaleString()}</td><td>24 weeks</td><td>$${(opportunity.maxValue * 3.5).toLocaleString()}</td><td>3.5√ó</td></tr>
</table>

<h3>4.2 Value Creation Analysis</h3>
<table>
<tr><th>Metric</th><th>Before AI</th><th>After AI</th><th>Improvement</th></tr>
<tr><td>${industryData.metric1.name}</td><td>${industryData.metric1.before}</td><td>${industryData.metric1.after}</td><td>${industryData.metric1.improvement}</td></tr>
<tr><td>${industryData.metric2.name}</td><td>${industryData.metric2.before}</td><td>${industryData.metric2.after}</td><td>${industryData.metric2.improvement}</td></tr>
<tr><td>${industryData.metric3.name}</td><td>${industryData.metric3.before}</td><td>${industryData.metric3.after}</td><td>${industryData.metric3.improvement}</td></tr>
</table>

<h2>5 | Executive Brief</h2>
<article>
<h3>${opportunity.company} AI Initiative ‚Äì Executive Summary</h3>
<h4>Why Now?</h4>
<p>${industryData.whyNow}</p>
<h4>Project Scope</h4>
<p>Phase 1 delivers ${industryData.phase1Scope}; Phase 2 adds ${industryData.phase2Scope}; Phase 3 creates ${industryData.phase3Scope}.</p>
<h4>Solution Overview</h4>
<ol>
${industryData.solutionPoints.map(point => `<li>${point}</li>`).join('\n')}
</ol>
<h4>Projected ROI</h4>
<p>${opportunity.easyMoney ? 'Quick implementation with 2-3 month payback' : 'Strategic transformation with 4-6 month payback'}; Full platform delivers ${opportunity.easyMoney ? '2.5√ó' : '3.5√ó'} first-year ROI.</p>
<h4>Next Steps</h4>
<p>Schedule discovery session ‚Üí analyze current operations ‚Üí demonstrate AI impact on actual use cases.</p>
</article>

${opportunity.easyMoney ? `
<h2>üî• Easy Money Opportunity</h2>
<div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin: 20px 0; border: 2px solid #ff9800;">
<h3>Why This is Perfect for New Consultants:</h3>
<ul>
<li><strong>Clear Problem:</strong> ${opportunity.painPoint || 'Well-defined operational challenge'}</li>
<li><strong>Proven Solution:</strong> We have templates and frameworks ready</li>
<li><strong>Quick Implementation:</strong> 4-6 weeks to show tangible results</li>
<li><strong>Low Risk:</strong> Minimal customization required</li>
<li><strong>High Impact:</strong> Immediate efficiency gains visible to stakeholders</li>
</ul>
</div>
` : ''}

${opportunity.type === 'partner' ? `
<h2>üåü Partner Opportunity Analysis</h2>
<table>
<tr><th>Partner Tier</th><th>Revenue Multiplier</th><th>Total Addressable Market</th></tr>
<tr><td>${opportunity.partnerTier || 'Gold'}</td><td>${opportunity.multiplier || '10'}√ó</td><td>$${((opportunity.maxValue * (opportunity.multiplier || 10))).toLocaleString()}</td></tr>
</table>
<p><strong>Partner Strategy:</strong> Initial engagement leads to ${opportunity.multiplier || '10'} additional implementations through partner channel.</p>
` : ''}

<h2>6 | Supporting Information</h2>
<h3>Industry Context</h3>
<ul>
<li>Market Size: ${industryData.marketSize}</li>
<li>Growth Rate: ${industryData.marketGrowth}</li>
<li>Key Challenges: ${industryData.challenges}</li>
<li>Technology Adoption: ${industryData.techAdoption}</li>
</ul>

<h3>Success Metrics</h3>
<ul>
${industryData.successMetrics.map(metric => `<li>${metric}</li>`).join('\n')}
</ul>

<footer>¬© 2025 AI Consulting Playbook ‚Äì ${opportunity.company} Opportunity Analysis. Generated ${new Date().toLocaleDateString()}</footer>
</body>
</html>`;
  },

  getIndustryData: function(industry) {
    const industries = {
      'Technology': {
        products: 'Software Solutions, SaaS Platforms, Development Tools',
        description: 'Provides technology solutions and software services to businesses',
        businessModel: 'Subscription-based SaaS with professional services',
        compliance: 'SOC 2, GDPR, CCPA compliance requirements',
        marketGrowth: 'growing 15% annually',
        trends: 'AI integration, automation, cloud migration',
        painPoints: 'Manual processes consuming 40% of developer time',
        solutions: 'Code automation, intelligent testing, deployment AI',
        integrations: 'GitHub, Jira, Slack, AWS/Azure, CI/CD pipelines',
        mvpDeliverable: 'Automated code review and testing suite',
        coreDeliverable: 'Full development lifecycle automation',
        fullDeliverable: 'AI-powered development platform',
        metric1: { name: 'Development Velocity', before: '10 features/sprint', after: '18 features/sprint', improvement: '80% increase' },
        metric2: { name: 'Bug Detection', before: '60% pre-release', after: '95% pre-release', improvement: '58% improvement' },
        metric3: { name: 'Time to Deploy', before: '4 hours', after: '30 minutes', improvement: '87% reduction' },
        whyNow: 'Development teams face mounting pressure to deliver faster while maintaining quality; AI automation enables both.',
        phase1Scope: 'Automated testing and code review',
        phase2Scope: 'Intelligent deployment and monitoring',
        phase3Scope: 'Full AI-assisted development ecosystem',
        solutionPoints: [
          'AI Code Review ‚Äì Catches bugs before they reach production',
          'Automated Testing ‚Äì Generates and runs comprehensive test suites',
          'Deployment Intelligence ‚Äì Predicts and prevents deployment failures',
          'Performance Optimization ‚Äì AI-driven code and infrastructure improvements'
        ],
        marketSize: '$500B globally',
        challenges: 'Technical debt, skill shortages, rapid technology change',
        techAdoption: 'High - early adopters of new technologies',
        successMetrics: ['Deployment frequency', 'Lead time for changes', 'Mean time to recovery', 'Change failure rate']
      },
      'Healthcare': {
        products: 'Clinical Management Systems, Patient Care Platforms, Medical Devices',
        description: 'Delivers healthcare services and medical technology solutions',
        businessModel: 'Fee-for-service with technology licensing',
        compliance: 'HIPAA, FDA regulations, state medical board requirements',
        marketGrowth: 'growing 12% annually',
        trends: 'Telemedicine, AI diagnostics, personalized medicine',
        painPoints: 'Clinical staff spending 50% of time on documentation',
        solutions: 'Clinical AI assistant, automated documentation, predictive analytics',
        integrations: 'Epic, Cerner, HL7/FHIR, medical devices, lab systems',
        mvpDeliverable: 'AI clinical documentation assistant',
        coreDeliverable: 'Integrated clinical intelligence platform',
        fullDeliverable: 'Complete AI-powered care delivery system',
        metric1: { name: 'Documentation Time', before: '2 hours/day', after: '30 minutes/day', improvement: '75% reduction' },
        metric2: { name: 'Patient Throughput', before: '20 patients/day', after: '28 patients/day', improvement: '40% increase' },
        metric3: { name: 'Clinical Accuracy', before: '92%', after: '98%', improvement: '6% improvement' },
        whyNow: 'Healthcare faces critical staffing shortages while demand surges; AI enables better care with existing resources.',
        phase1Scope: 'Clinical documentation automation',
        phase2Scope: 'Diagnostic assistance and care recommendations',
        phase3Scope: 'Comprehensive AI care platform',
        solutionPoints: [
          'Voice-to-Clinical Notes ‚Äì Real-time documentation during patient visits',
          'Diagnostic AI ‚Äì Suggests diagnoses based on symptoms and history',
          'Treatment Optimization ‚Äì Recommends evidence-based treatment plans',
          'Predictive Health ‚Äì Identifies at-risk patients before complications'
        ],
        marketSize: '$4.3T in US alone',
        challenges: 'Regulatory compliance, interoperability, change management',
        techAdoption: 'Moderate - careful adoption with pilot programs',
        successMetrics: ['Patient satisfaction scores', 'Clinical quality metrics', 'Staff efficiency', 'Revenue per patient']
      },
      'Finance': {
        products: 'Banking Services, Investment Platforms, Risk Management Tools',
        description: 'Provides financial services and risk management solutions',
        businessModel: 'Transaction fees with advisory services',
        compliance: 'SEC, FINRA, Basel III, AML/KYC requirements',
        marketGrowth: 'growing 10% annually',
        trends: 'Open banking, embedded finance, real-time payments',
        painPoints: 'Manual risk assessment taking days, missing opportunities',
        solutions: 'AI risk modeling, fraud detection, automated compliance',
        integrations: 'Core banking systems, payment networks, market data feeds',
        mvpDeliverable: 'AI-powered risk assessment tool',
        coreDeliverable: 'Intelligent financial operations platform',
        fullDeliverable: 'End-to-end AI financial ecosystem',
        metric1: { name: 'Risk Assessment Time', before: '3 days', after: '30 minutes', improvement: '99% reduction' },
        metric2: { name: 'Fraud Detection', before: '70% accuracy', after: '95% accuracy', improvement: '36% improvement' },
        metric3: { name: 'Compliance Cost', before: '$2M/year', after: '$800K/year', improvement: '60% reduction' },
        whyNow: 'Increasing regulatory pressure and competition from fintechs demand AI-powered efficiency and accuracy.',
        phase1Scope: 'Automated risk assessment and fraud detection',
        phase2Scope: 'AI compliance monitoring and reporting',
        phase3Scope: 'Full AI-driven financial operations',
        solutionPoints: [
          'Real-time Risk AI ‚Äì Instant credit and market risk assessment',
          'Fraud Prevention ‚Äì Pattern recognition stops fraud before losses',
          'Compliance Automation ‚Äì Ensures regulatory adherence automatically',
          'Customer Intelligence ‚Äì Predicts needs and prevents churn'
        ],
        marketSize: '$25T global market',
        challenges: 'Legacy systems, regulatory complexity, security concerns',
        techAdoption: 'High in specific areas (trading, risk), moderate elsewhere',
        successMetrics: ['Risk-adjusted returns', 'Compliance incidents', 'Processing time', 'Customer acquisition cost']
      },
      'Manufacturing': {
        products: 'Industrial Equipment, Production Systems, Quality Control',
        description: 'Manufactures products with complex production processes',
        businessModel: 'Product sales with service contracts',
        compliance: 'ISO 9001, OSHA, environmental regulations',
        marketGrowth: 'growing 8% annually',
        trends: 'Industry 4.0, smart factories, predictive maintenance',
        painPoints: 'Quality defects costing 5-10% of revenue',
        solutions: 'Computer vision QC, predictive maintenance, production optimization',
        integrations: 'MES, ERP, PLCs, SCADA systems, IoT sensors',
        mvpDeliverable: 'AI visual quality inspection system',
        coreDeliverable: 'Smart factory operations platform',
        fullDeliverable: 'Complete AI manufacturing ecosystem',
        metric1: { name: 'Defect Rate', before: '3%', after: '0.3%', improvement: '90% reduction' },
        metric2: { name: 'Downtime', before: '8%', after: '2%', improvement: '75% reduction' },
        metric3: { name: 'Production Efficiency', before: '70% OEE', after: '85% OEE', improvement: '21% improvement' },
        whyNow: 'Global competition and margin pressure require AI-driven efficiency to remain competitive.',
        phase1Scope: 'Visual quality inspection and defect prevention',
        phase2Scope: 'Predictive maintenance and optimization',
        phase3Scope: 'Full smart factory transformation',
        solutionPoints: [
          'Vision AI Quality Control ‚Äì Catches defects human inspectors miss',
          'Predictive Maintenance ‚Äì Prevents breakdowns before they occur',
          'Production Optimization ‚Äì AI schedules for maximum efficiency',
          'Supply Chain Intelligence ‚Äì Predicts and prevents disruptions'
        ],
        marketSize: '$12T global manufacturing',
        challenges: 'Legacy equipment, workforce training, capital investment',
        techAdoption: 'Moderate - proven ROI drives adoption',
        successMetrics: ['Overall Equipment Effectiveness', 'First Pass Yield', 'Cost per unit', 'On-time delivery']
      },
      'default': {
        products: 'Industry-specific Solutions and Services',
        description: 'Provides specialized services to their market segment',
        businessModel: 'Service delivery with technology enablement',
        compliance: 'Industry-specific regulations and standards',
        marketGrowth: 'growing steadily',
        trends: 'Digital transformation, automation, data analytics',
        painPoints: 'Manual processes limiting growth and efficiency',
        solutions: 'Process automation, data intelligence, workflow optimization',
        integrations: 'Industry-standard systems and platforms',
        mvpDeliverable: 'Core process automation',
        coreDeliverable: 'Integrated operations platform',
        fullDeliverable: 'Complete digital transformation',
        metric1: { name: 'Process Efficiency', before: 'Baseline', after: '40% improvement', improvement: '40% gain' },
        metric2: { name: 'Data Accuracy', before: '85%', after: '98%', improvement: '15% improvement' },
        metric3: { name: 'Customer Satisfaction', before: '3.5/5', after: '4.5/5', improvement: '29% increase' },
        whyNow: 'Digital transformation is no longer optional; AI provides the competitive edge needed to thrive.',
        phase1Scope: 'Core automation and efficiency gains',
        phase2Scope: 'Advanced analytics and optimization',
        phase3Scope: 'Full digital ecosystem',
        solutionPoints: [
          'Process Automation ‚Äì Eliminates manual repetitive tasks',
          'Data Intelligence ‚Äì Turns information into actionable insights',
          'Workflow Optimization ‚Äì Streamlines operations end-to-end',
          'Predictive Analytics ‚Äì Anticipates issues before they impact business'
        ],
        marketSize: 'Varies by industry',
        challenges: 'Change management, technology adoption, budget constraints',
        techAdoption: 'Varies - increasing across all sectors',
        successMetrics: ['Operational efficiency', 'Cost reduction', 'Revenue growth', 'Customer retention']
      }
    };

    return industries[industry] || industries['default'];
  }
};

// GLOBAL STATE
let opportunities = [];
let currentContactCompany = null;
let currentFileData = null;

// INITIALIZE
document.addEventListener('DOMContentLoaded', () => {
  loadOpportunities();
  updateDashboard();
  renderOpportunities();
  initializeDefaultOpportunities();
});

// Initialize with default opportunities
function initializeDefaultOpportunities() {
  if (opportunities.length === 0) {
    opportunities = [
      {
        id: 1,
        company: "RainFocus",
        description: "Solutions Consultant - Event tech AI transformation",
        type: "direct",
        score: 88,
        value: 1200000,
        minValue: 25000,
        maxValue: 1200000,
        displayValue: "$25K-$1.2M",
        stage: "qualified",
        industry: "Technology", 
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/RainFocus_Solutions_Consultant_Guide.html",
        easyMoney: true,
        outreachScript: "RainFocus events generate massive data. Our AI turns attendee behavior into actionable insights that boost sponsor ROI by 40%.",
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 2,
        company: "Mountain America Credit Union",
        description: "CRM Solutions Architect - Member experience AI",
        type: "direct",
        score: 82,
        value: 950000,
        minValue: 25000,
        maxValue: 950000, 
        displayValue: "$25K-$950K",
        stage: "qualified",
        industry: "Financial Services",
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Mountain_America_Credit_Union_CRM_Solutions_Architect_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 3,
        company: "SSC (Salentica)",
        description: "CRM Solutions Consultant - Alternative investment AI",
        type: "direct",
        score: 79,
        value: 850000,
        minValue: 25000,
        maxValue: 850000,
        displayValue: "$25K-$850K",
        stage: "discovered",
        industry: "Financial Services",
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/SSC_Salentica_CRM_Solutions_Consultant_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 4,
        company: "Red Pepper Software",
        description: "Sr Technical Implementation Consultant - Healthcare AI",
        type: "direct",
        score: 76,
        value: 1100000,
        minValue: 25000,
        maxValue: 1100000,
        displayValue: "$25K-$1.1M",
        stage: "discovered",
        industry: "Healthcare Technology",
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Red_Pepper_Software_Sr_Technical_Implementation_Consultant_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 5,
        company: "Gong",
        description: "Professional Services Consultant - Revenue intelligence AI",
        type: "partner",
        score: 91,
        value: 15000000,
        minValue: 25000,
        maxValue: 15000000,
        displayValue: "$25K-$15M+",
        stage: "qualified",
        industry: "Technology",
        partnerTier: "platinum",
        multiplier: 50,
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Gong_Professional_Services_Consultant_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 6,
        company: "Mashura Consulting",
        description: "Veterinary Implementation Consultant - Pet care AI",
        type: "direct",
        score: 73,
        value: 650000,
        minValue: 45000,
        maxValue: 650000,
        displayValue: "$45K-$650K",
        stage: "discovered",
        industry: "Healthcare",
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Mashura_Veterinary_Implementation_Consultant_Guide.html",
        easyMoney: true,
        outreachScript: "Vet clinics using our AI see 30% more patients with the same staff. Documentation time drops 75%.",
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 7,
        company: "Zions Bancorporation",
        description: "Salesforce Solutions Architect - Banking automation AI",
        type: "direct",
        score: 85,
        value: 1400000,
        minValue: 25000,
        maxValue: 1400000,
        displayValue: "$25K-$1.4M",
        stage: "contacted",
        industry: "Financial Services",
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Zions_Bancorp_Salesforce_Solutions_Architect_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 8,
        company: "RLDatix",
        description: "Sales Engineer - Patient safety AI platform",
        type: "partner",
        score: 77,
        value: 2500000,
        minValue: 25000,
        maxValue: 2500000,
        displayValue: "$25K-$2.5M",
        stage: "discovered",
        industry: "Healthcare Technology",
        partnerTier: "gold",
        multiplier: 10,
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/RLDatix_Sales_Engineer_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 9,
        company: "Coesia (Flexlink)",
        description: "Sales Engineer - Manufacturing line AI optimization",
        type: "direct",
        score: 74,
        value: 875000,
        minValue: 25000,
        maxValue: 875000,
        displayValue: "$25K-$875K",
        stage: "discovered",
        industry: "Manufacturing",
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Coesia_Flexlink_Sales_Engineer_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 10,
        company: "Fuchs Lubricants",
        description: "Sales Service Engineer - Predictive maintenance AI",
        type: "direct",
        score: 75,
        value: 750000,
        minValue: 25000,
        maxValue: 750000,
        displayValue: "$25K-$750K",
        stage: "discovered",
        industry: "Industrial",
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Fuchs_Lubricants_Sales_Service_Engineer_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 11,
        company: "Salesforce",
        description: "Pre-Sales Consultant Admin - Platform AI enhancement",
        type: "direct",
        score: 80,
        value: 1100000,
        minValue: 25000,
        maxValue: 1100000,
        displayValue: "$25K-$1.1M",
        stage: "qualified",
        industry: "Technology",
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Salesforce_Pre_Sales_Consultant_Admin_Guide.html",
        easyMoney: true,
        outreachScript: "Salesforce + Einstein AI is a proven combo. Our enhancements are so straightforward that junior consultants complete these in weeks.",
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 12,
        company: "Deloitte",
        description: "Dynamics CRM Consultant - Big 4 enterprise partner",
        type: "partner",
        score: 92,
        value: 10000000,
        minValue: 50000,
        maxValue: 10000000,
        displayValue: "$50K-$10M+",
        stage: "qualified",
        industry: "Professional Services",
        partnerTier: "platinum",
        multiplier: 50,
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Deloitte_Dynamics_CRM_Consultant_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 13,
        company: "PwC",
        description: "Oracle Field Service Consultant - Big 4 field service AI",
        type: "partner",
        score: 90,
        value: 8500000,
        minValue: 50000,
        maxValue: 8500000,
        displayValue: "$50K-$8.5M",
        stage: "discovered",
        industry: "Professional Services",
        partnerTier: "platinum",
        multiplier: 50,
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/PwC_Oracle_Field_Service_Consultant_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 14,
        company: "Protiviti",
        description: "Adobe Experience Senior Consultant - MarTech AI",
        type: "partner",
        score: 78,
        value: 1750000,
        minValue: 25000,
        maxValue: 1750000,
        displayValue: "$25K-$1.75M",
        stage: "discovered",
        industry: "Professional Services",
        partnerTier: "gold",
        multiplier: 10,
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Protiviti_Adobe_Experience_Senior_Consultant_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 15,
        company: "Solventum",
        description: "Implementation Consultant - Medical device AI",
        type: "direct",
        score: 76,
        value: 900000,
        minValue: 25000,
        maxValue: 900000,
        displayValue: "$25K-$900K",
        stage: "discovered",
        industry: "Healthcare Technology",
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Solventum_Implementation_Consultant_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 16,
        company: "Workday",
        description: "Solution Consulting Enablement Lead - HR AI platform",
        type: "partner",
        score: 89,
        value: 12000000,
        minValue: 25000,
        maxValue: 12000000,
        displayValue: "$25K-$12M+",
        stage: "qualified",
        industry: "Technology",
        partnerTier: "platinum",
        multiplier: 100,
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Workday_Solution_Consulting_Enablement_Lead_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 17,
        company: "CaseWorthy",
        description: "Solutions Consultant - Social services AI",
        type: "direct",
        score: 72,
        value: 550000,
        minValue: 35000,
        maxValue: 550000,
        displayValue: "$35K-$550K",
        stage: "discovered",
        industry: "Public Sector",
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/CaseWorthy_Solutions_Consultant_Guide.html",
        easyMoney: true,
        outreachScript: "Social workers spend 60% of time on paperwork. Our AI cuts that to 15%, letting them focus on helping families.",
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 18,
        company: "Eide Bailly",
        description: "Solutions Consultant CRM - Accounting firm AI",
        type: "partner",
        score: 81,
        value: 3000000,
        minValue: 25000,
        maxValue: 3000000,
        displayValue: "$25K-$3M",
        stage: "contacted",
        industry: "Professional Services",
        partnerTier: "gold",
        multiplier: 20,
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Eide_Bailly_Solutions_Consultant_CRM_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 19,
        company: "Addepar",
        description: "ADM Solutions Consultant - Wealth management AI",
        type: "direct",
        score: 83,
        value: 1300000,
        minValue: 25000,
        maxValue: 1300000,
        displayValue: "$25K-$1.3M",
        stage: "qualified",
        industry: "Financial Services",
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Addepar_ADM_Solutions_Consultant_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      },
      {
        id: 20,
        company: "Silac Insurance",
        description: "Solutions Architect - Insurance underwriting AI",
        type: "direct",
        score: 77,
        value: 800000,
        minValue: 25000,
        maxValue: 800000,
        displayValue: "$25K-$800K",
        stage: "discovered",
        industry: "Insurance",
        guideCreated: true,
        guideUrl: "C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/Silac_Insurance_Solutions_Architect_Guide.html",
        easyMoney: false,
        dateAdded: "2025-01-03T10:00:00.000Z"
      }
    ];
    saveOpportunities();
  }
}

// Save opportunities to localStorage
function saveOpportunities() {
  localStorage.setItem('aiOpportunities', JSON.stringify(opportunities));
}

// Load opportunities from localStorage
function loadOpportunities() {
  const saved = localStorage.getItem('aiOpportunities');
  if (saved) {
    opportunities = JSON.parse(saved);
  }
}

// Update dashboard metrics
function updateDashboard() {
  const totalOpps = opportunities.length;
  const totalValue = opportunities.reduce((sum, opp) => sum + opp.maxValue, 0);
  const avgScore = totalOpps > 0 ? Math.round(opportunities.reduce((sum, opp) => sum + opp.score, 0) / totalOpps) : 0;
  const easyMoney = opportunities.filter(opp => opp.easyMoney).length;
  
  document.getElementById('totalOpportunities').textContent = totalOpps;
  document.getElementById('totalValue').textContent = formatValue(totalValue);
  document.getElementById('avgScore').textContent = avgScore;
  document.getElementById('easyMoneyCount').textContent = easyMoney;
}

// Render opportunities table
function renderOpportunities() {
  const tbody = document.getElementById('opportunitiesTable');
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  const typeFilter = document.getElementById('typeFilter').value;
  const stageFilter = document.getElementById('stageFilter').value;
  
  const filtered = opportunities.filter(opp => {
    const matchesSearch = !searchTerm || 
      opp.company.toLowerCase().includes(searchTerm) ||
      opp.description.toLowerCase().includes(searchTerm);
    const matchesType = typeFilter === 'all' || opp.type === typeFilter;
    const matchesStage = stageFilter === 'all' || opp.stage === stageFilter;
    
    return matchesSearch && matchesType && matchesStage;
  });
  
  tbody.innerHTML = filtered.map(opp => `
    <tr>
      <td>
        <div class="company-info">
          <div class="company-name">
            ${opp.company}
            ${opp.easyMoney ? '<span class="easy-money" title="Easy money - perfect for new consultants!">üî•</span>' : ''}
          </div>
          <div class="company-desc">${opp.description}</div>
        </div>
      </td>
      <td>
        <span class="badge badge-${opp.type}">
          ${opp.type.toUpperCase()}
          ${opp.multiplier ? ` (${opp.multiplier}x)` : ''}
        </span>
      </td>
      <td>
        <span class="score-badge score-${getScoreClass(opp.score)}">${opp.score}</span>
      </td>
      <td>
        <div class="value-range">
          <span class="min">${formatValue(opp.minValue)}</span>
          <span>‚Üí</span>
          <span class="max">${formatValue(opp.maxValue)}</span>
        </div>
      </td>
      <td>${opp.stage}</td>
      <td>${new Date(opp.dateAdded).toLocaleDateString()}</td>
      <td>
        <div class="action-buttons">
          <button class="btn btn-primary" onclick="viewOpportunity(${opp.id})">View</button>
          ${opp.guideCreated ? 
            `<button class="btn btn-success" onclick="viewGuide(${opp.id})">üìÑ Guide</button>` :
            `<button class="btn btn-warning" onclick="generateGuide(${opp.id})">Generate Guide</button>`
          }
          <button class="btn btn-contact" onclick="showContactOptions(${opp.id})">Contact</button>
          <button class="btn btn-danger" onclick="removeOpportunity(${opp.id})" title="Remove">‚ùå</button>
        </div>
      </td>
    </tr>
  `).join('');
}

// Remove opportunity
function removeOpportunity(id) {
  const opp = opportunities.find(o => o.id === id);
  if (!opp) return;
  
  if (confirm(`Remove ${opp.company} from opportunities?`)) {
    opportunities = opportunities.filter(o => o.id !== id);
    saveOpportunities();
    updateDashboard();
    renderOpportunities();
    showNotification(`${opp.company} removed from opportunities`, 'info');
  }
}

// Format value for display
function formatValue(value) {
  if (value >= 1000000) {
    return '$' + (value / 1000000).toFixed(1) + 'M';
  } else if (value >= 1000) {
    return '$' + Math.round(value / 1000) + 'K';
  }
  return '$' + value;
}

// Get score class
function getScoreClass(score) {
  if (score >= 80) return 'high';
  if (score >= 60) return 'medium';
  return 'low';
}

// Filter opportunities
function filterOpportunities() {
  renderOpportunities();
}

// Sort opportunities
function sortOpportunities() {
  const sortBy = document.getElementById('sortBy').value;
  
  opportunities.sort((a, b) => {
    switch(sortBy) {
      case 'score':
        return b.score - a.score;
      case 'value':
        return b.maxValue - a.maxValue;
      case 'company':
        return a.company.localeCompare(b.company);
      case 'dateAdded':
        return new Date(b.dateAdded) - new Date(a.dateAdded);
      default:
        return 0;
    }
  });
  
  renderOpportunities();
}

// View opportunity details
function viewOpportunity(id) {
  const opp = opportunities.find(o => o.id === id);
  if (!opp) return;
  
  const modalContent = document.getElementById('modalContent');
  modalContent.innerHTML = `
    <h2>${opp.company}</h2>
    <p style="color: #999; margin-bottom: 20px;">
      ${opp.description}
      ${opp.easyMoney ? '<span class="easy-money" title="Easy money - perfect for new consultants!">üî• Easy Money Opportunity!</span>' : ''}
    </p>
    
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
      <div>
        <strong>Type:</strong> ${opp.type}
        ${opp.partnerTier ? ` - ${opp.partnerTier.toUpperCase()}` : ''}
      </div>
      <div><strong>Score:</strong> ${opp.score}</div>
      <div>
        <strong>Value Range:</strong> 
        <div class="value-range">
          <span class="min">${formatValue(opp.minValue)}</span>
          <span>‚Üí</span>
          <span class="max">${formatValue(opp.maxValue)}</span>
        </div>
      </div>
      <div><strong>Stage:</strong> ${opp.stage}</div>
      <div><strong>Industry:</strong> ${opp.industry || 'General'}</div>
      <div><strong>Location:</strong> ${opp.location || 'Remote'}</div>
    </div>
    
    ${opp.painPoint ? `
    <div style="background: #f0f7ff; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
      <h3 style="margin-top: 0;">Pain Point</h3>
      <p>${opp.painPoint}</p>
      ${opp.hiddenNeed ? `<p><strong>Hidden AI Opportunity:</strong> ${opp.hiddenNeed}</p>` : ''}
    </div>
    ` : ''}
    
    ${opp.outreachScript ? `
    <div style="background: #f0fff0; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
      <h3 style="margin-top: 0;">Quick Pitch</h3>
      <p>${opp.outreachScript}</p>
    </div>
    ` : ''}
    
    ${opp.multiplier ? `
    <div style="background: #fff0ff; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
      <h3 style="margin-top: 0;">Partner Opportunity</h3>
      <p>Initial engagement can lead to ${opp.multiplier}x additional implementations through partner channel.</p>
      <p><strong>Total Addressable Value:</strong> ${formatValue(opp.maxValue * opp.multiplier)}</p>
    </div>
    ` : ''}
    
    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
      <button class="btn btn-primary" onclick="updateOpportunityStage(${opp.id})">Advance Stage</button>
      ${!opp.guideCreated ? 
        `<button class="btn btn-warning" onclick="generateGuide(${opp.id})">Generate Guide</button>` :
        `<button class="btn btn-success" onclick="viewGuide(${opp.id})">View Guide</button>`
      }
      <button class="btn btn-contact" onclick="showContactOptions(${opp.id})">Prepare Contact</button>
    </div>
  `;
  
  document.getElementById('opportunityModal').style.display = 'block';
}

// Generate guide
function generateGuide(id) {
  const opp = opportunities.find(o => o.id === id);
  if (!opp) return;
  
  showNotification('Generating comprehensive guide for ' + opp.company + '...', 'info');
  
  // Generate the guide content
  const guideContent = GuideGenerator.createGuide(opp);
  
  // Store the guide with the opportunity
  opp.guideCreated = true;
  opp.guideContent = guideContent;
  opp.guideUrl = `${opp.company.replace(/\s+/g, '_')}_Guide.html`;
  
  saveOpportunities();
  renderOpportunities();
  
  // Show the guide
  setTimeout(() => {
    showNotification('Guide generated successfully!', 'success');
    viewGuide(id);
  }, 1000);
}

// View guide
function viewGuide(id) {
  const opp = opportunities.find(o => o.id === id);
  if (!opp) return;
  
  const modalContent = document.getElementById('modalContent');
  
  if (opp.guideContent) {
    // Display the stored guide content
    modalContent.innerHTML = `
      <div class="guide-container">
        ${opp.guideContent}
      </div>
      <div class="guide-actions">
        <button class="btn btn-primary" onclick="downloadGuide(${opp.id})">üì• Download HTML</button>
        <button class="btn btn-secondary" onclick="copyGuideContent(${opp.id})">üìã Copy Content</button>
        <button class="btn btn-success" onclick="openGuideInNewTab(${opp.id})">üåê Open in New Tab</button>
      </div>
    `;
  } else {
    // For legacy opportunities with external guides
    const guideUrl = opp.guideUrl;
    const filePath = guideUrl.startsWith('C:') ? guideUrl : `C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/${guideUrl}`;
    
    modalContent.innerHTML = `
      <h2>üìö ${opp.company} Implementation Guide</h2>
      
      <div style="background: #e8f5e9; padding: 20px; border-radius: 10px; margin: 20px 0; border: 2px solid #4caf50;">
        <h3 style="color: #2e7d32;">‚úÖ Guide Ready!</h3>
        <p style="color: #333;">Your comprehensive AI implementation playbook is available.</p>
        <p style="color: #333;"><strong>üìç Path:</strong> ${filePath}</p>
      </div>
      
      <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin: 20px 0;">
        <h3 style="color: #ef6c00;">üöÄ Guide Contents:</h3>
        <ul style="color: #333;">
          <li>Executive Summary & Value Proposition</li>
          <li>8-Step Opportunity Analysis</li>
          <li>Phased Implementation Roadmap</li>
          <li>ROI Projections & Cost Calculator</li>
          <li>Industry-Specific Solutions</li>
          <li>Risk Mitigation Strategies</li>
        </ul>
      </div>
      
      <p style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
        <strong>Note:</strong> This guide was created with the original batch. To view, copy the path and paste in File Explorer.
      </p>
    `;
  }
  
  document.getElementById('opportunityModal').style.display = 'block';
}

// Download guide
function downloadGuide(id) {
  const opp = opportunities.find(o => o.id === id);
  if (!opp || !opp.guideContent) return;
  
  const blob = new Blob([opp.guideContent], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = opp.guideUrl;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  showNotification('Guide downloaded!', 'success');
}

// Copy guide content
function copyGuideContent(id) {
  const opp = opportunities.find(o => o.id === id);
  if (!opp || !opp.guideContent) return;
  
  const tempDiv = document.createElement('div');
  tempDiv.innerHTML = opp.guideContent;
  const textContent = tempDiv.textContent || tempDiv.innerText;
  
  navigator.clipboard.writeText(textContent).then(() => {
    showNotification('Guide content copied to clipboard!', 'success');
  });
}

// Open guide in new tab
function openGuideInNewTab(id) {
  const opp = opportunities.find(o => o.id === id);
  if (!opp || !opp.guideContent) return;
  
  const newWindow = window.open('', '_blank');
  newWindow.document.write(opp.guideContent);
  newWindow.document.close();
}

// Show contact options
function showContactOptions(id) {
  const opp = opportunities.find(o => o.id === id);
  if (!opp) return;
  
  currentContactCompany = opp;
  document.getElementById('contactCompanyName').textContent = `Contact ${opp.company}`;
  
  // Generate outreach scripts
  const emailScript = `Subject: AI Solution for ${opp.company}'s ${opp.painPoint || 'Operations'}

Hi [Name],

I noticed ${opp.company} is ${opp.description.toLowerCase()}. ${opp.hiddenNeed ? `While that role focuses on ${opp.title}, I believe your real need is ${opp.hiddenNeed}.` : ''}

We've helped similar ${opp.industry || 'companies'} achieve:
‚Ä¢ ${opp.easyMoney ? '2-3 month' : '4-6 month'} payback period
‚Ä¢ ${opp.easyMoney ? '25%' : '35-50%'} efficiency improvement
‚Ä¢ Clear ROI from day one

Would you be open to a brief call to discuss how AI could transform your ${opp.painPoint || 'operations'}?

Best regards,
[Your name]`;

  const linkedinScript = `Hi [Name], I saw ${opp.company} is hiring for ${opp.title}. ${opp.hiddenNeed ? `That tells me you're dealing with ${opp.painPoint}. We specialize in ${opp.hiddenNeed} - would love to show you how AI can solve this permanently.` : `We help ${opp.industry || 'companies'} like yours leverage AI for dramatic efficiency gains.`} Open to a quick chat?`;

  const callScript = `Opening: "Hi [Name], I'm calling about the ${opp.title} role at ${opp.company}."

Hook: "${opp.hiddenNeed ? `I believe what you really need is ${opp.hiddenNeed} to address ${opp.painPoint}.` : `We help companies like yours achieve 35-50% efficiency gains through AI.`}"

Value Prop: "We've done this for [similar company] and they saw results in ${opp.easyMoney ? '6 weeks' : '12 weeks'}."

Close: "Can we schedule 20 minutes this week to discuss your specific situation?"`;

  document.getElementById('emailScript').textContent = emailScript;
  document.getElementById('linkedinScript').textContent = linkedinScript;
  document.getElementById('callScript').textContent = callScript;
  
  document.getElementById('contactModal').style.display = 'block';
}

// Close contact modal
function closeContactModal() {
  document.getElementById('contactModal').style.display = 'none';
}

// Contact actions
function sendEmail() {
  if (currentContactCompany) {
    const subject = `AI Solution for ${currentContactCompany.company}'s ${currentContactCompany.painPoint || 'Operations'}`;
    const body = document.getElementById('emailScript').textContent;
    window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    
    // Update stage
    if (currentContactCompany.stage === 'discovered' || currentContactCompany.stage === 'qualified') {
      currentContactCompany.stage = 'contacted';
      saveOpportunities();
      updateDashboard();
      renderOpportunities();
    }
    
    showNotification('Email client opened. Stage updated to Contacted.', 'success');
    closeContactModal();
  }
}

function openLinkedIn() {
  if (currentContactCompany) {
    window.open(`https://www.linkedin.com/search/results/people/?keywords=${encodeURIComponent(currentContactCompany.company)}`, '_blank');
    showNotification('LinkedIn search opened', 'info');
  }
}

function makeCall() {
  showNotification('Add phone number to opportunity data for direct dial', 'info');
}

function scheduleFollowUp() {
  const days = prompt('Schedule follow-up in how many days?', '3');
  if (days) {
    showNotification(`Follow-up scheduled for ${days} days from now`, 'success');
  }
}

// Close modal
function closeModal() {
  document.getElementById('opportunityModal').style.display = 'none';
}

// Update stage
function updateOpportunityStage(id) {
  const opp = opportunities.find(o => o.id === id);
  if (!opp) return;
  
  const stages = ['discovered', 'qualified', 'contacted', 'proposal', 'negotiation', 'closed'];
  const currentIndex = stages.indexOf(opp.stage);
  const nextStage = stages[(currentIndex + 1) % stages.length];
  
  opp.stage = nextStage;
  saveOpportunities();
  updateDashboard();
  renderOpportunities();
  showNotification(`${opp.company} moved to ${nextStage} stage`, 'success');
}

// Drag and drop handlers
function handleDragOver(e) {
  e.preventDefault();
  e.stopPropagation();
  document.getElementById('dropZone').classList.add('drag-over');
}

function handleDragLeave(e) {
  e.preventDefault();
  e.stopPropagation();
  document.getElementById('dropZone').classList.remove('drag-over');
}

function handleDrop(e) {
  e.preventDefault();
  e.stopPropagation();
  document.getElementById('dropZone').classList.remove('drag-over');
  
  const files = e.dataTransfer.files;
  processFiles(files);
}

function handleFileSelect(e) {
  const files = e.target.files;
  processFiles(files);
}

// Process uploaded files
function processFiles(files) {
  for (let file of files) {
    if (file.type === 'text/html' || file.name.endsWith('.html')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        extractDataFromHTML(e.target.result, file.name);
      };
      reader.readAsText(file);
    }
  }
}

// Extract data from HTML guide
function extractDataFromHTML(htmlContent, fileName) {
  const parser = new DOMParser();
  const doc = parser.parseFromString(htmlContent, 'text/html');
  
  // Extract company name from title or h1
  let company = doc.querySelector('title')?.textContent?.split(' ')[0] || 
                doc.querySelector('h1')?.textContent?.split(' ')[0] ||
                fileName.split('_')[0];
  
  // Try to extract more data
  const description = extractTextAfter(doc, 'Job Type:') || 
                     extractTextAfter(doc, 'Description:') || 
                     'Uploaded opportunity';
  
  const industry = extractTextAfter(doc, 'Industry:') || 
                  extractTextAfter(doc, 'Sector:') || 
                  'General';
  
  const value = extractValue(doc) || 500000;
  const minValue = extractMinValue(doc) || value * 0.1;
  
  // Create opportunity data
  currentFileData = {
    id: Date.now() + Math.random(),
    company: company,
    description: description,
    type: fileName.toLowerCase().includes('partner') ? 'partner' : 'direct',
    score: 75,
    value: value,
    minValue: minValue,
    maxValue: value,
    displayValue: `${formatValue(minValue)}-${formatValue(value)}`,
    industry: industry,
    guideCreated: true,
    guideUrl: fileName,
    guideContent: htmlContent,
    easyMoney: false,
    dateAdded: new Date().toISOString()
  };
  
  // Show stage selection modal
  document.getElementById('modalCompanyName').textContent = company;
  document.getElementById('stageModal').style.display = 'flex';
}

// Helper function to extract text after a label
function extractTextAfter(doc, label) {
  const elements = doc.querySelectorAll('*');
  for (let el of elements) {
    if (el.textContent.includes(label)) {
      const match = el.textContent.match(new RegExp(label + '\\s*(.+)'));
      if (match) return match[1].trim();
    }
  }
  return null;
}

// Extract value from document
function extractValue(doc) {
  const text = doc.body.textContent;
  const match = text.match(/\$(\d+(?:,\d+)*(?:\.\d+)?)\s*([MK])/i);
  if (match) {
    const num = parseFloat(match[1].replace(/,/g, ''));
    const mult = match[2].toUpperCase() === 'M' ? 1000000 : 1000;
    return num * mult;
  }
  return 500000;
}

// Extract minimum value
function extractMinValue(doc) {
  const text = doc.body.textContent;
  const match = text.match(/MVP.*?\$(\d+(?:,\d+)*(?:\.\d+)?)\s*([MK])/i);
  if (match) {
    const num = parseFloat(match[1].replace(/,/g, ''));
    const mult = match[2].toUpperCase() === 'M' ? 1000000 : 1000;
    return num * mult;
  }
  return null;
}

// Select stage for imported opportunity
function selectStage(stage) {
  if (currentFileData) {
    currentFileData.stage = stage;
    
    // Check for duplicates
    const existing = opportunities.find(o => 
      o.company.toLowerCase() === currentFileData.company.toLowerCase() &&
      o.type === currentFileData.type
    );
    
    if (existing) {
      if (confirm(`${currentFileData.company} already exists. Add as a separate opportunity?`)) {
        currentFileData.company += ' (2)';
        opportunities.push(currentFileData);
      }
    } else {
      opportunities.push(currentFileData);
    }
    
    saveOpportunities();
    updateDashboard();
    renderOpportunities();
    showNotification(`${currentFileData.company} added to ${stage} stage`, 'success');
    
    currentFileData = null;
  }
  
  document.getElementById('stageModal').style.display = 'none';
}

// Show notification
function showNotification(message, type = 'info') {
  const notification = document.getElementById('notification');
  notification.textContent = message;
  notification.className = 'notification show';
  
  if (type === 'success') {
    notification.style.background = 'var(--success)';
  } else if (type === 'info') {
    notification.style.background = 'var(--secondary)';
  }
  
  setTimeout(() => {
    notification.classList.remove('show');
  }, 3000);
}

// Generate guide
function generateGuide(id) {
  const opp = opportunities.find(o => o.id === id);
  if (!opp) return;
  
  const modalContent = document.getElementById('modalContent');
  modalContent.innerHTML = `
    <h2>üìù Generate Guide for ${opp.company}</h2>
    
    <div style="background: #f0f7ff; padding: 20px; border-radius: 10px; margin: 20px 0;">
      <h3 style="margin-top: 0;">Company Information</h3>
      <p><strong>Company:</strong> ${opp.company}</p>
      <p><strong>Description:</strong> ${opp.description}</p>
      <p><strong>Industry:</strong> ${opp.industry || 'General'}</p>
      <p><strong>Value Range:</strong> ${formatValue(opp.minValue)} - ${formatValue(opp.maxValue)}</p>
      <p><strong>Type:</strong> ${opp.type} ${opp.multiplier ? `(${opp.multiplier}x multiplier)` : ''}</p>
      ${opp.painPoint ? `<p><strong>Pain Point:</strong> ${opp.painPoint}</p>` : ''}
      ${opp.location ? `<p><strong>Location:</strong> ${opp.location}</p>` : ''}
    </div>
    
    <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin: 20px 0;">
      <h3 style="margin-top: 0;">üìã Guide Creation Steps:</h3>
      <ol>
        <li>Copy the company information above</li>
        <li>Have Claude create a comprehensive guide matching the original 20</li>
        <li>Save the guide to: <code>C:\\Users\\carls\\OneDrive\\Desktop\\Utlyze lead gen program\\the leads\\claudeTry\\</code></li>
        <li>Name it: <code>${opp.company.replace(/\s+/g, '_')}_Guide.html</code></li>
        <li>Once saved, check the box below</li>
      </ol>
    </div>
    
    <div style="background: #e8f5e9; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
      <label style="font-size: 18px; cursor: pointer;">
        <input type="checkbox" id="guideCreatedCheck" style="width: 20px; height: 20px; margin-right: 10px; vertical-align: middle;">
        <strong>‚úÖ I have created and saved the guide</strong>
      </label>
    </div>
    
    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 30px;">
      <button class="btn btn-primary" onclick="confirmGuideCreated(${opp.id})">Confirm Guide Created</button>
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
    </div>
  `;
  
  document.getElementById('opportunityModal').style.display = 'block';
}

// Confirm guide was created
function confirmGuideCreated(id) {
  const checkbox = document.getElementById('guideCreatedCheck');
  if (!checkbox.checked) {
    showNotification('Please check the box to confirm the guide was created', 'info');
    return;
  }
  
  const opp = opportunities.find(o => o.id === id);
  if (!opp) return;
  
  opp.guideCreated = true;
  opp.guideUrl = `C:/Users/carls/OneDrive/Desktop/Utlyze lead gen program/the leads/claudeTry/${opp.company.replace(/\s+/g, '_')}_Guide.html`;
  
  saveOpportunities();
  renderOpportunities();
  closeModal();
  showNotification(`${opp.company} guide marked as created!`, 'success');
}

// View guide - uses existing openGuide function
function viewGuide(id) {
  const opp = opportunities.find(o => o.id === id);
  if (!opp || !opp.guideUrl) return;
  
  openGuide(opp.guideUrl);
}

// Theme toggle
function toggleTheme() {
  document.body.classList.toggle('light-mode');
  const isDark = !document.body.classList.contains('light-mode');
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  document.querySelector('.theme-toggle').textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
}

// Load theme
const savedTheme = localStorage.getItem('theme');
if (savedTheme === 'light') {
  document.body.classList.add('light-mode');
  document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
}

// Run automated search
async function runAutomatedSearch() {
  const searchBtn = event.target;
  searchBtn.disabled = true;
  searchBtn.textContent = 'üîÑ Searching...';
  
  showNotification('Starting AI opportunity search...', 'info');
  
  try {
    // Use popup window to avoid CORS
    const searchWindow = window.open('search-proxy.html', 'search', 'width=100,height=100');
    
    // Listen for results
    const messageHandler = (event) => {
      if (event.data && event.data.type === 'searchResults') {
        window.removeEventListener('message', messageHandler);
        const data = event.data.data;
        
        if (data.success && data.opportunities) {
          // Add new opportunities
          const newOpps = data.opportunities.map(opp => ({
            ...opp,
            id: opp.id || Date.now() + Math.random(),
            stage: opp.stage || 'discovered',
            dateAdded: opp.dateAdded || new Date().toISOString()
          }));
          
          opportunities.push(...newOpps);
          saveOpportunities();
          updateDashboard();
          renderOpportunities();
          
          showNotification(`Found ${newOpps.length} new opportunities!`, 'success');
        } else {
          showNotification('Search completed but no opportunities found', 'info');
        }
        
        searchBtn.disabled = false;
        searchBtn.textContent = 'üîç Run Automated Search';
      }
    };
    
    window.addEventListener('message', messageHandler);
    
    // Timeout fallback
    setTimeout(() => {
      window.removeEventListener('message', messageHandler);
      if (searchBtn.disabled) {
        searchBtn.disabled = false;
        searchBtn.textContent = 'üîç Run Automated Search';
        showNotification('Search timeout - please try again', 'info');
      }
    }, 10000);
    
  } catch (error) {
    console.error('Search error:', error);
    showNotification('Search error: ' + error.message, 'error');
    searchBtn.disabled = false;
    searchBtn.textContent = 'üîç Run Automated Search';
  }
}

// Export opportunities
function exportOpportunities() {
  const data = {
    exported: new Date().toISOString(),
    opportunities: opportunities,
    summary: {
      total: opportunities.length,
      totalValue: opportunities.reduce((sum, opp) => sum + opp.maxValue, 0),
      byStage: {},
      byType: {}
    }
  };
  
  // Calculate summaries
  opportunities.forEach(opp => {
    data.summary.byStage[opp.stage] = (data.summary.byStage[opp.stage] || 0) + 1;
    data.summary.byType[opp.type] = (data.summary.byType[opp.type] || 0) + 1;
  });
  
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `ai_opportunities_${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  showNotification('Pipeline exported successfully!', 'success');
}

// Show best practices
function showBestPractices() {
  const modalContent = document.getElementById('modalContent');
  modalContent.innerHTML = `
    <h2>üí° AI Consulting Best Practices</h2>
    
    <div style="margin: 20px 0;">
      <h3>üéØ Qualifying Opportunities</h3>
      <ul>
        <li><strong>Hidden Needs:</strong> Companies hiring for "Inventory Manager" often need AI counting systems</li>
        <li><strong>Pain Points:</strong> Look for manual processes, Excel-heavy workflows, paper forms</li>
        <li><strong>Budget Indicators:</strong> Recent funding, growing headcount, "digital transformation" mentions</li>
        <li><strong>Easy Money:</strong> Simple implementations with existing templates - perfect for new consultants</li>
      </ul>
      
      <h3>üìä Value Pricing</h3>
      <ul>
        <li><strong>Discovery:</strong> Always charge $10-25K for assessment phase</li>
        <li><strong>MVP:</strong> Quick wins at 30-50% of full project value</li>
        <li><strong>Ongoing:</strong> 5-10% of project value monthly for support</li>
        <li><strong>Never below $50K:</strong> Professional minimum for any engagement</li>
      </ul>
      
      <h3>üöÄ Engagement Strategy</h3>
      <ul>
        <li><strong>Start Small:</strong> Prove value with MVP before full implementation</li>
        <li><strong>Show ROI Fast:</strong> Target 2-3 month payback for easy money, 4-6 for complex</li>
        <li><strong>Partner Multipliers:</strong> One Big 4 engagement can lead to 50+ implementations</li>
        <li><strong>Industry Focus:</strong> Become the AI expert for specific verticals</li>
      </ul>
      
      <h3>üé® Using Smart Cameras</h3>
      <ul>
        <li><strong>Warehouses:</strong> Inventory counting, safety monitoring</li>
        <li><strong>Retail:</strong> Customer flow, queue management</li>
        <li><strong>Manufacturing:</strong> Quality control, assembly verification</li>
        <li><strong>Parking:</strong> Occupancy tracking, revenue optimization</li>
      </ul>
    </div>
  `;
  
  document.getElementById('opportunityModal').style.display = 'block';
}

// Initialize search proxy check
window.addEventListener('load', () => {
  // Check if search-proxy.html exists by trying to fetch it
  fetch('search-proxy.html', { method: 'HEAD' })
    .then(response => {
      if (!response.ok) {
        console.warn('search-proxy.html not found. Search functionality may be limited.');
      }
    })
    .catch(() => {
      console.warn('Could not check for search-proxy.html');
    });
});
</script>

</body>
</html>